import { client } from "@/sanity/lib/client"; // ‡πÄ‡∏ä‡πá‡∏Ñ path ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö
import { groq } from "next-sanity";
import NavbarClient from "./NavbarClient";

// 1. üìù ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Sanity (GROQ Query)
// ‡πÄ‡∏£‡∏≤‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ‡πÉ‡∏ô NavbarClient ‡πÄ‡∏•‡∏¢
const query = groq`
  *[_type == "navigation" && title == "Main Menu"][0] {
    items[] {
      label,
      type,
      link,
      // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Stair Menu
      sections[] {
        title,
        links
      },
      // ‡∏î‡∏∂‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏á URL ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏¢
      featuredImage {
        "src": asset->url,
        alt
      }
    }
  }
`;

// 2. üêπ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö Go Backend (‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)
async function fetchCartCountFromGo() {
  // ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô:
  // const res = await fetch('https://api.mediaforyou.store/cart/count', { cache: 'no-store' })
  // return res.json()
  return 2; // ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏°‡∏µ 2 ‡∏ä‡∏¥‡πâ‡∏ô‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô
}

export default async function Navbar() {
  // --- 3. Parallel Fetching (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô ‡πÄ‡∏£‡πá‡∏ß‡∏°‡∏≤‡∏Å‡∏ö‡∏ô Bun) ---
  // ‡∏™‡∏±‡πà‡∏á‡∏î‡∏∂‡∏á Sanity ‡πÅ‡∏•‡∏∞ Go ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏Ñ‡∏¥‡∏ß
  const [sanityData, cartCount] = await Promise.all([
    client.fetch(query).catch(() => null), // ‡∏ñ‡πâ‡∏≤‡∏û‡∏±‡∏á ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ null (‡πÑ‡∏õ‡πÉ‡∏ä‡πâ Hardcode)
    fetchCartCountFromGo().catch(() => 0)
  ]);

  // --- 4. ‡πÅ‡∏õ‡∏•‡∏á‡∏£‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Data Transformation) ---
  // ‡∏ñ‡πâ‡∏≤ Sanity ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏à‡∏±‡∏î Format ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà NavbarClient ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
  // (‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡πÄ‡∏£‡∏≤‡∏°‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Logic ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏±‡∏ô‡∏ï‡∏≠‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏£‡∏≠‡∏Å Sanity ‡πÄ‡∏™‡∏£‡πá‡∏à)
  // ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡πà‡∏á sanityData ‡∏î‡∏¥‡∏ö‡πÜ ‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡πà‡∏á null ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡∏Å‡∏¥‡∏ô Fallback

  return (
    <NavbarClient 
      sanityMenu={sanityData ? sanityData : null} // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏™‡πà‡∏á null ‡πÑ‡∏õ‡πÉ‡∏ä‡πâ Fallback
      // cartCount={cartCount} // (‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡∏™‡πà‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏à‡∏≤‡∏Å Go ‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏ß‡∏¢)
    />
  );
}